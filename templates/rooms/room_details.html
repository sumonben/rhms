{% extends 'basepage/basepage.html' %}
{% load static  %}

    <!-- Page Preloder -->
    <!-- <div id="preloder">
        <div class="loader"></div>
    </div> -->

    <!-- Offcanvas Menu Section Begin -->
    
    {% block content %}
    <!-- Breadcrumb Section End -->

    
    <!-- Room Details Section Begin -->
     <br>
     <br>
      <br>
      <br>
    <section class="room-details-section spad">
        <div class="container">
            <div class="row">
                <div class="col-lg-8">
                    <div class="room-details-item" style="background: var(--service);">
                        <img src="{{ room.main_image.url }}" alt="">
                        <div class="rd-text" style="background: transparent;padding: 20px;">
                            <div class="rd-title">
                               {% if messages %}
      <div class="container" style="margin-top: 15px;">
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }} alert-dismissible fade show" style="color: #000;" role="alert">
            {{ message }}
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
        {% endfor %}
      </div>
    {% endif %}
                              <h3>{{ room.name_eng }} #{{ room.room_no }}</h3><br>
                                <div class="rdt-right">
                                    <div class="rating">
                                  {% if average_rating_int %}
                                    {% for _ in "12345"|make_list %}
                                      {% if forloop.counter <= average_rating_int %}
                                        <i class="icon_star"></i>
                                      {% else %}
                                        <i class="icon_star" style="opacity: 0.35;"></i>
                                      {% endif %}
                                    {% endfor %}
                                  {% else %}
                                    <i class="icon_star" style="opacity: 0.35;"></i>
                                    <i class="icon_star" style="opacity: 0.35;"></i>
                                    <i class="icon_star" style="opacity: 0.35;"></i>
                                    <i class="icon_star" style="opacity: 0.35;"></i>
                                    <i class="icon_star" style="opacity: 0.35;"></i>
                                  {% endif %}
                                    </div>
                                {% if average_rating %}
                                  <div style="margin-top: 5px; font-size: 14px; color: #666;">
                                    Average rating: {{ average_rating }}/5
                                  </div>
                                {% endif %}
                                    {% with status=room.display_status|default:room.status|default_if_none:"available"|lower %}
                                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                                      {% if status == 'available' %}
                                        <button id="room_{{ room.id }}" class="btn btn-primary" style="padding: 12px 24px; font-size: 16px; font-weight: 600;" onclick="addToCart( this.id )">Add To Book</button>
                                        <button class="btn btn-success" style="padding: 12px 24px; font-size: 16px; font-weight: 600; text-align: center;" onclick="bookNowSingle('room_{{ room.id }}')">Book Now</button>
                                      {% else %}
                                        <button class="btn btn-primary" style="padding: 12px 24px; font-size: 16px; font-weight: 600; opacity: 0.6; cursor: not-allowed;" disabled>
                                          {% if status == 'booked' %}
                                            Booked{% if room.booked_until %} till {{ room.booked_until }}{% endif %} <i class="fa fa-check"></i>
                                          {% elif status == 'unavailable' %}
                                            Unavailable <i class="fa fa-ban"></i>
                                          {% else %}
                                            Occupied <i class="fa fa-check"></i>
                                          {% endif %}
                                        </button>
                                        <button class="btn btn-success" style="padding: 12px 24px; font-size: 16px; font-weight: 600; text-align: center; opacity: 0.6; cursor: not-allowed;" disabled>
                                          {% if status == 'booked' %}
                                            Booked{% if room.booked_until %} till {{ room.booked_until }}{% endif %} <i class="fa fa-check"></i>
                                          {% elif status == 'unavailable' %}
                                            Unavailable <i class="fa fa-ban"></i>
                                          {% else %}
                                            Occupied <i class="fa fa-check"></i>
                                          {% endif %}
                                        </button>
                                      {% endif %}
                                    </div>
                                    {% endwith %}
                                </div>
                            </div>
                            <h3>{{ room.room_type.name_eng }} </h3>
                            <h2>{{ room.price }}&#x09F3;<span>/Pernight</span></h2>
                            <table>
                                <tbody>
                                    <tr>
                                        <td class="r-o">Size:</td>
                                        <td>{{ room.size }} sqft</td>
                                    </tr>
                                    <tr>
                                        <td class="r-o">Capacity:</td>
                                        <td>Max persion {{ room.person_occupancy  }}</td>
                                    </tr>
                                    <tr>
                                        <td class="r-o">Bed:</td>
                                        <td>{{ room.room_type.name_eng }}</td>
                                    </tr>
                                    <tr>
                                        <td class="r-o">Services:</td>
                                        <td>{{ room.services }}</td>
                                    </tr>
                                </tbody>
                            </table>
                            <p class="f-para">
                                
                                {% if room.description %}
                                    {{ room.description }}

                                {% endif %}
                                    
                            </p>
                           
                        </div>
                    </div>
<style>
#slider {
  position: relative;
  overflow: hidden;
  margin: 20px auto 0 auto;
  border-radius: 4px;
}

#slider ul {
  position: relative;
  margin: 0;
  padding: 0;
  height: 180px;
  list-style: none;
}

#slider ul li {
  position: relative;
  display: block;
  float: left;
  margin: 0 10px;
  padding: 15px;
  width: 150px;
  height: 160px;
  background: #f5f5f5;
  text-align: center;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  transition: transform 0.3s ease;
}

#slider ul li:hover {
  transform: translateY(-5px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

a.control_prev,
a.control_next {
  position: absolute;
  z-index: 999;
  display: block;
  padding: 15px 10px;
  width: auto;
  height: auto;
  background: #dfa974;
  color: #fff;
  text-decoration: none;
  font-weight: 600;
  font-size: 20px;
  opacity: 0.8;
  cursor: pointer;
  top: 50%;
  transform: translateY(-50%);
  border-radius: 4px;
}

a.control_prev:hover,
a.control_next:hover {
  opacity: 1;
  background: #c89d6c;
  -webkit-transition: all 0.2s ease;
}

a.control_prev {
  left: -10px;
}

a.control_next {
  right: -10px;
}

.slider_option {
  position: relative;
  margin: 10px auto;
  width: 160px;
  font-size: 18px;
}

.similar-rooms-section {
  background: #fafafa;
  padding: 25px;
  border-radius: 8px;
  border: 1px solid #e0e0e0;
}
</style>

<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

<!-- Debug: same_priced_rooms exists: {{ same_priced_rooms|length }} -->
{% if same_priced_rooms %}
<div class="similar-rooms-section" style="margin-top: 30px;">
    <h4 style="margin-bottom: 20px; color: #dfa974;">Similar Priced Rooms ({{ room.price }}&#x09F3;/night) - {{ same_priced_rooms|length }} found</h4>
    <div id="slider">
      <a href="#" class="control_next">>></a>
      <a href="#" class="control_prev"><</a>
      <ul>
        {% for similar_room in same_priced_rooms %}
        <li style="{% cycle 'background: #f0f0f0;' 'background: #e0e0e0;' %}">
            <a href="{% url 'room_details' similar_room.id %}" style="text-decoration: none; color: #333; display: block; height: 100%; padding: 10px;">
                <div style="text-align: center;">
                    {% if similar_room.main_image %}
                        <img src="{{ similar_room.main_image.url }}" alt="{{ similar_room.name_eng }}" style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px; margin-bottom: 8px;">
                    {% else %}
                        <div style="width: 80px; height: 80px; background: #ddd; border-radius: 8px; margin: 0 auto 8px; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #999;">No Image</div>
                    {% endif %}
                    <div style="font-size: 14px; font-weight: 600;">{{ similar_room.room_no }}</div>
                    <div style="font-size: 12px; color: #666;">{{ similar_room.name_eng }}</div>
                </div>
            </a>
        </li>
        {% endfor %}
      </ul>
    </div>
</div>
{% else %}
<!-- Debug: No similar priced rooms found or variable not set -->
{% endif %}


                    
                    <div class="rd-reviews">
                      <h4>Reviews</h4>
                      {% if room_reviews %}
                        {% for review in room_reviews %}
                          <div class="review-item">
                            <div class="ri-pic">
                              <img src="{% static 'img/room/avatar/avatar-1.jpg' %}" alt="">
                            </div>
                            <div class="ri-text">
                              <span>{{ review.created_at|date:"d M Y" }}</span>
                              <div class="rating">
                                {% for _ in "12345"|make_list %}
                                  {% if forloop.counter <= review.rating %}
                                    <i class="icon_star"></i>
                                  {% else %}
                                    <i class="icon_star" style="opacity: 0.35;"></i>
                                  {% endif %}
                                {% endfor %}
                              </div>
                              <h5>{{ review.name }}</h5>
                              <p>{{ review.comment }}</p>
                            </div>
                          </div>
                        {% endfor %}
                      {% else %}
                        <p>No reviews yet. Be the first to leave a review.</p>
                      {% endif %}
                    </div>
                    <div class="review-add">
                      <h4>Add Review</h4>
                      <form action="{% url 'room_review' room.id %}" method="post" class="ra-form">
                        {% csrf_token %}
                        <div class="row">
                          <div class="col-lg-6">
                            <input type="text" name="name" placeholder="Name*" required>
                          </div>
                          <div class="col-lg-6">
                            <input type="email" name="email" placeholder="Email*" required>
                          </div>
                          <div class="col-lg-6">
                            <input type="text" name="phone" placeholder="Mobile Number*" required>
                          </div>
                          <div class="col-lg-12">
                            <div>
                              <h5>Your Rating:</h5>
                              <select name="rating" class="form-select" required style="max-width: 220px;">
                                <option value="">Select rating</option>
                                <option value="5">5 - Excellent</option>
                                <option value="4">4 - Good</option>
                                <option value="3">3 - متوسط</option>
                                <option value="2">2 - Fair</option>
                                <option value="1">1 - Poor</option>
                              </select>
                            </div>
                            <textarea name="comment" placeholder="Your Review" required></textarea>
                            <button type="submit">Submit Now</button>
                          </div>
                        </div>
                      </form>
                    </div>
                </div>
                <div class="col-lg-4">
                        <div class="booking-form" style="background: var(--weather)" >
                        <h3 >Book Your Room</h3>
                        <form action="{% url 'frontpage' %}" method="POST">
                            {% csrf_token %}
                            <div class="check-date">
                                <label for="date-in">Check In:</label>
                                <input type="date" class="date-input" id="date-in" name="check_in" required>
                            </div>
                            <div class="check-date">
                                <label for="date-out">Check Out:</label>
                                <input type="date" class="date-input" id="date-out" name="check_out" required>
                            </div>
                            <div class="select-option">
                                <label for="guest">Guests:</label>
                                <select name="guests" id="guest" class="form-select">
                                    <option value="1">1 Adult</option>
                                    <option value="2" selected>2 Adults</option>
                                    <option value="3">3 Adults</option>
                                    <option value="4">4 Adults</option>
                                    <option value="5">5 Adults</option>
                                    <option value="6">6 Adults</option>
                                </select>
                            </div>
                            <div class="select-option">
                                <label for="room">Room:</label>
                                <select name="rooms" id="room" class="form-select">
                                    <option value="1" selected>1 Room</option>
                                    <option value="2">2 Rooms</option>
                                    <option value="3">3 Rooms</option>
                                    <option value="4">4 Rooms</option>
                                    <option value="5">5 Rooms</option>  
                                </select>
                            </div>
                            <button type="submit">Check Availability</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Room Details Section End -->
    <script>
jQuery(document).ready(function($) {
  var slider = $('#slider');
  
  if (slider.length && slider.find('ul li').length > 0) {
    var slideCount = slider.find('ul li').length;
    var slideWidth = 170; // Fixed width including margin
    var slideHeight = 180;
    var visibleSlides = Math.min(4, slideCount); // Show max 4 slides or less if not enough
    var sliderUlWidth = slideCount * slideWidth;

    slider.css({
      width: slideWidth * visibleSlides,
      height: slideHeight
    });

    // Only apply carousel logic if we have more slides than visible
    if (slideCount > visibleSlides) {
      slider.find('ul').css({
        width: sliderUlWidth,
        marginLeft: -slideWidth,
        position: 'relative',
        left: 0
      });

      slider.find('ul li:last-child').prependTo(slider.find('ul'));

      function moveLeft() {
        slider.find('ul').stop(true, false).animate({
          left: +slideWidth
        }, 400, function() {
          slider.find('ul li:last-child').prependTo(slider.find('ul'));
          slider.find('ul').css('left', 0);
        });
      }

      function moveRight() {
        slider.find('ul').stop(true, false).animate({
          left: -slideWidth
        }, 400, function() {
          slider.find('ul li:first-child').appendTo(slider.find('ul'));
          slider.find('ul').css('left', 0);
        });
      }

      $('a.control_prev').click(function(e) {
        e.preventDefault();
        moveLeft();
      });

      $('a.control_next').click(function(e) {
        e.preventDefault();
        moveRight();
      });
    } else {
      // Just display items normally without carousel
      slider.find('ul').css({
        width: sliderUlWidth,
        marginLeft: 0,
        position: 'relative',
        left: 0
      });
      
      // Hide controls if not enough slides
      $('.control_prev, .control_next').hide();
    }
  }
});
    </script>
    {% endblock content %}
